{"version":3,"sources":["../../../../assets/scripts/assets/scripts/game.js"],"names":["mEmitter","require","config","cc","Class","extends","Component","properties","bg_1","Node","bg_2","title","Label","gameReadyLayer","gamePlayingLayer","gamePauseLayer","gameOverLayer","heroSkinsLayer","rankedLayer","settingsLayer","waveTitle","_LayerList","default","type","score","scoreOver","pre_hero","Prefab","_hero","pre_creep","pre_assassin","pre_motherShip","pre_bullet","sound_clip","AudioClip","_waveNum","Integer","notify","initWave","_timer","onLoad","temp","sys","localStorage","getItem","log","sound","audioEngine","play","instance","manager","director","getCollisionManager","enabled","getData","init","setTouch","registerEvent","event","UPDATE_VOLUME","setSoundVolume","bind","UPDATE_SCORE","updateScore","GAME_OVER","gameFinished","start","number","setVolume","update","dt","setBg","gameState","PLAYING","bulletTime","createBullet","isBgMove","y","height","zIndex","loadLayer","READY","string","spawnCreepTime","spawnAssasinTime","spawnMotherShipTime","level","node","on","name","pos_hero","getPosition","pos_mov","getDelta","x","setPosition","v2","OVER","removeAllBullet","removeAllEnemy","createEnemy","pre_enemy","index","allRow","Math","floor","enemy","instantiate","js","getComponent","speed","targetpos","parent","spawnHero","Number","updateLevel","pos","bullet","children","i","length","onBulletKilled","onEnemyKilled","removeHero","onHeroKilled","len","active","onDestroy","setItem","JSON","stringtify","waveContent","clickBtn","sender","str","ENEMY_DESTROY","waveStatus","emit","UPDATE_GAMESTATE","PAUSE","HEROSKINS","RANKED","SETTINGS","loader","loadRes","getWaveData","err","obj","json","wave","waveCount","wavecount","waveNum","content","totalEnemy","allCol","sologan","setWave","blink","hide","fadeTo","spawn","callFunc","map","item","waveAction","sequence","setTag","runAction"],"mappings":"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","file":"game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["const mEmitter = require(\"./mEmitter\");\nconst config = require(\"config\");\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg_1: cc.Node,\n        bg_2: cc.Node,\n        title: cc.Label,\n\n\n        gameReadyLayer: cc.Node,\n        gamePlayingLayer: cc.Node,\n        gamePauseLayer: cc.Node,\n        gameOverLayer: cc.Node,\n        heroSkinsLayer: cc.Node,\n        rankedLayer: cc.Node,\n        settingsLayer: cc.Node,\n        waveTitle: cc.Node,\n\n        _LayerList: {\n            default: [],\n            type: [cc.Node]\n        },\n\n        score: cc.Label,\n        scoreOver: cc.Label,\n\n        pre_hero: cc.Prefab,\n        _hero: cc.Node,\n\n        pre_creep: cc.Prefab,\n        pre_assassin: cc.Prefab,\n        pre_motherShip: cc.Prefab,\n        pre_bullet: cc.Prefab,\n\n\n        sound_clip: {\n            default: null,\n            type: cc.AudioClip\n        },\n        _waveNum: {\n            default: 1,\n            type: cc.Integer,\n            notify: function () {\n                this.initWave(this._waveNum)\n            }\n        },\n        _timer: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this._LayerList = [\n            this.gameReadyLayer,\n            this.gamePlayingLayer,\n            this.gamePauseLayer,\n            this.gameOverLayer,\n            this.heroSkinsLayer,\n            this.rankedLayer,\n            this.settingsLayer,\n        ]\n        var temp =cc.sys.localStorage.getItem('wave')\n        cc.log('Content')\n        cc.log(temp)\n        this.sound = cc.audioEngine.play(this.sound_clip, true, 0);\n        //cc.log(this._LayerList)\n        mEmitter.instance = new mEmitter();\n        //cc.log(config.event.UPDATE_SCORE)\n        let manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        //manager.enabledDebugDraw = true;\n        this.getData()\n        this.init();\n        this.setTouch()\n        mEmitter.instance.registerEvent(config.event.UPDATE_VOLUME, this.setSoundVolume.bind(this))\n        mEmitter.instance.registerEvent(config.event.UPDATE_SCORE, this.updateScore.bind(this))\n        mEmitter.instance.registerEvent(config.event.GAME_OVER, this.gameFinished.bind(this))\n    },\n\n    start() { },\n    setSoundVolume(number) {\n        cc.audioEngine.setVolume(this.sound, number);\n    },\n    update(dt) {\n        this.setBg();\n        if (this.gameState == config.gameState.PLAYING) {\n            this.bulletTime++;\n            this._timer += dt\n            if (this.bulletTime == 10) {\n                this.bulletTime = 0;\n                this.createBullet();\n            }\n            // this.spawnCreeps(dt);\n            // this.spawnAssassins(dt);\n            // this.spawnMotherShips(dt);\n        }\n    },\n    init() {\n        this.isBgMove = false;\n        this.bg_1.y = 0;\n        this.bg_2.y = this.bg_1.y + this.bg_1.height;\n        this.gameReadyLayer.zIndex = 1;\n        // this.gameOverLayer.zIndex = -1;\n        this.gamePauseLayer.zIndex = 2;\n        //this.score.zIndex = 3;\n        this.loadLayer(this.gameReadyLayer);\n        this.bulletTime = 0;\n        this.gameState = config.gameState.READY\n        this.score.string = 0;\n\n        this.spawnCreepTime = 0\n        this.spawnAssasinTime = 0\n        this.spawnMotherShipTime = 0\n        this.level = 1\n    },\n    setTouch() {\n        this.node.on(\"touchstart\", function (event) {\n            // this.gameState = config.gameState.PLAYING;\n            // this.gameReadyLayer.active = false;\n            // this.gamePlayingLayer.active = true;\n            //this.gameOverLayer.active = false;\n            //this.isBgMove = true;\n        }, this);\n        this.node.on(\"touchmove\", function (event) {\n            if (this._hero.name != \"\") {\n                let pos_hero = this._hero.getPosition()\n                let pos_mov = event.getDelta()\n                let x = pos_hero.x + pos_mov.x\n                let y = pos_hero.y + pos_mov.y\n                if (x < 280 && x > -280)\n                    if (y < 400 && y > -400)\n                        this._hero.setPosition(cc.v2(x, y))\n            }\n        }, this);\n        this.node.on(\"touchend\", function (event) {\n            cc.log(\"touchend\")\n        }, this)\n    },\n    gameFinished() {\n        this.gameState = config.gameState.OVER;\n        this.removeAllBullet()\n        this.removeAllEnemy()\n\n        this.loadLayer(this.gameOverLayer)\n        this.scoreOver.string = this.score.string;\n    },\n    // spawnCreeps(dt) {\n    //     this.spawnCreepTime += dt;\n    //     if (this.spawnCreepTime >= 1 / this.level) {\n    //         this.spawnCreepTime = 0;\n    //         this.createEnemy(this.pre_creep, 1)\n    //     }\n    // },\n    // spawnAssassins(dt) {\n    //     this.spawnAssasinTime += dt;\n    //     if (this.spawnAssasinTime >= 2 / this.level) {\n    //         this.spawnAssasinTime = 0;\n    //         this.createEnemy(this.pre_assassin, 2)\n    //     }\n    // },\n    // spawnMotherShips(dt) {\n    //     this.spawnMotherShipTime += dt;\n    //     if (this.spawnMotherShipTime >= 5 / this.level) {\n    //         this.spawnMotherShipTime = 0;\n    //         this.createEnemy(this.pre_motherShip, 0.2)\n    //     }\n    // },\n    createEnemy(pre_enemy, index) {\n        let x = (index) % this.allRow\n        let y = Math.floor(index / this.allRow);\n        let enemy = cc.instantiate(pre_enemy)\n        enemy.setPosition(0, 1000)\n        let js = enemy.getComponent(\"enemy\")\n        js.speed=2\n        js.targetpos=cc.v2(x * 100 - (100 * this.allRow / 2) + 50, y * 100)\n        // var fly = cc.moveTo(3, cc.v2(x * 100 - (100 * this.allRow / 2) + 50, y * 100))\n        // enemy.runAction(fly)\n        // enemy.setMoveTo(x * 100 - (100 * this.allRow / 2) + 50,y*100)\n        enemy.parent = this.node\n    },\n    spawnHero() {\n        this._hero = cc.instantiate(this.pre_hero)\n        this._hero.parent = this.node\n        this._hero.setPosition(cc.v2(0, -300))\n    },\n    updateScore(score) {\n        //cc.log(\"tets\")\n        this.score.string = Number(this.score.string) + score\n        this.updateLevel();\n    },\n    updateLevel() {\n        this.level = Math.floor(this.score.string / 50) + 1;\n    },\n    setBg() {\n        if (this.isBgMove) {\n            this.bg_2.y -= 0.5;\n            this.bg_1.y -= 0.5;\n            if (this.bg_1.y <= -this.bg_1.height)\n                this.bg_1.y = this.bg_2.y + this.bg_1.height;\n            if (this.bg_2.y <= -this.bg_2.height)\n                this.bg_2.y = this.bg_1.y + this.bg_2.height;\n        }\n    },\n    createBullet() {\n        if (this._hero.name != \"\") {\n            let pos = this._hero.getPosition()\n            let bullet = cc.instantiate(this.pre_bullet)\n            bullet.parent = this.node;\n            bullet.setPosition(cc.v2(pos.x, pos.y + this._hero.height / 2))\n        }\n    },\n\n    removeAllBullet() {\n        let children = this.node.children\n        for (let i = children.length - 1; i >= 0; i--) {\n            let bullet = children[i].getComponent(\"bullet\")\n            if (bullet)\n                bullet.onBulletKilled()\n        }\n    },\n    removeAllEnemy() {\n        let children = this.node.children\n        for (let i = children.length - 1; i >= 0; i--) {\n            let enemy = children[i].getComponent(\"enemy\")\n            if (enemy)\n                enemy.onEnemyKilled()\n        }\n    },\n    removeHero() {\n        let children = this.node.children\n        for (let i = children.length - 1; i >= 0; i--) {\n            let enemy = children[i].getComponent(\"hero\")\n            if (enemy) {\n                enemy.onHeroKilled()\n            }\n        }\n    },\n    loadLayer(node) {\n        let len = this._LayerList.length\n        for (let i = 0; i < len; i++) {\n            if (this._LayerList[i] === node)\n                this._LayerList[i].active = true;\n            else\n                this._LayerList[i].active = false;\n        }\n    },\n    onDestroy(){\n        cc.sys.localStorage.setItem('wave',JSON.stringtify(this.waveContent))\n    },\n    clickBtn(sender, str) {\n        //cc.log(str)\n        switch (str) {\n            case \"play\":\n                this.spawnHero();\n                this._waveNum = 1\n                mEmitter.instance.registerEvent(config.event.ENEMY_DESTROY, this.waveStatus.bind(this))\n            case \"resume\":\n                this.isBgMove = true;\n                this.loadLayer(this.gamePlayingLayer)\n                this.gameState = config.gameState.PLAYING;\n                mEmitter.instance.emit(config.event.UPDATE_GAMESTATE, this.gameState)\n                break;\n            case \"pause\":\n                this.isBgMove = false;\n                this.loadLayer(this.gamePauseLayer)\n                this.gameState = config.gameState.PAUSE;\n                mEmitter.instance.emit(config.event.UPDATE_GAMESTATE, this.gameState)\n                break;\n            case \"restart\":\n                this.isBgMove = false;\n                this.loadLayer(this.gameReadyLayer)\n                this.gameState = config.gameState.READY;\n                this.removeAllBullet()\n                this.removeAllEnemy()\n                this.removeHero()\n                this.init();\n                break;\n            case \"skins\":\n                this.loadLayer(this.heroSkinsLayer)\n                this.gameState = config.gameState.HEROSKINS;\n                break;\n            case \"ranked\":\n                this.loadLayer(this.rankedLayer)\n                this.gameState = config.gameState.RANKED;\n                break;\n            case \"settings\":\n                this.loadLayer(this.settingsLayer)\n                this.gameState = config.gameState.SETTINGS;\n                break;\n            case \"back\":\n                this.loadLayer(this.gameReadyLayer)\n                this.gameState = config.gameState.READY;\n                break;\n            default:\n                break;\n        }\n    },\n    //read json\n    getData() {\n        cc.loader.loadRes('waveconfig.json', this.getWaveData.bind(this))\n    },\n    getWaveData(err, obj) {\n        if (err) {\n            cc.log(err)\n            return;\n        }\n        this.waveContent = obj.json.wave\n        this.waveCount = obj.json.wavecount\n    },\n    waveStatus() {\n\n    },\n    initWave(waveNum) {\n\n        if (1 > this.waveCount) {\n            cc.log('overLoad');\n            this.gameFinished()\n            return;\n        }\n        cc.log(this.waveContent[waveNum])\n        let content = this.waveContent[waveNum].content;\n        this.totalEnemy = this.waveContent[waveNum].enemy;\n        this.allRow = this.waveContent[waveNum].allRow;\n        this.allCol = this.waveContent[waveNum].allCol;\n        cc.log(content)\n        let title = 'Wave ' + waveNum;\n        let sologan = this.waveContent[waveNum].sologan;\n        let waveTitle = this.waveTitle.getComponent('wavetitle')\n        waveTitle.setWave(title, sologan)\n        let blink = cc.blink(1, 3)\n        let hide = cc.fadeTo(3, 0)\n        let spawn = cc.spawn(hide, cc.callFunc(() => {\n            content.map((item, index) => {\n                switch (item) {\n                    case 1:\n                        {\n                            this.createEnemy(this.pre_creep, index)\n                            break;\n                        }\n                    case 2:\n                        {\n                            this.createEnemy(this.pre_assassin, index)\n                            break;\n                        }\n                    case 3:\n                        {\n                            this.createEnemy(this.pre_motherShip, index)\n                            break;\n                        }\n                    default: {\n                        break;\n                    }\n                }\n            })\n        }))\n        let waveAction = cc.sequence(blink, spawn)\n        waveAction.setTag(1)\n        this.waveTitle.runAction(waveAction)\n    },\n    waveStatus() {\n        this.totalEnemy--\n        cc.log(this.totalEnemy)\n        if (this.totalEnemy == 0) {\n            this._waveNum++\n            cc.log('Change wave')\n        }\n    },\n});"]}