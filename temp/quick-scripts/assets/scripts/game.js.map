{"version":3,"sources":["game.js"],"names":["mEmitter","require","config","cc","Class","extends","Component","properties","bg_1","Node","bg_2","title","Label","gameReadyLayer","gamePlayingLayer","gamePauseLayer","gameOverLayer","heroSkinsLayer","rankedLayer","settingsLayer","_LayerList","default","type","score","scoreOver","pre_hero","Prefab","_hero","pre_creep","pre_assassin","pre_motherShip","pre_bullet","sound_clip","AudioClip","_waveNum","Integer","notify","index","log","onLoad","sound","audioEngine","play","instance","manager","director","getCollisionManager","enabled","getData","init","setTouch","registerEvent","event","UPDATE_VOLUME","setSoundVolume","bind","UPDATE_SCORE","updateScore","GAME_OVER","gameFinished","start","number","setVolume","update","dt","setBg","gameState","PLAYING","bulletTime","createBullet","isBgMove","y","height","zIndex","loadLayer","READY","string","spawnCreepTime","spawnAssasinTime","spawnMotherShipTime","level","node","on","name","pos_hero","getPosition","pos_mov","getDelta","x","setPosition","v2","OVER","removeAllBullet","removeAllEnemy","spawnCreeps","createEnemy","spawnAssassins","spawnMotherShips","pre_enemy","speed","Math","floor","random","enemy","instantiate","js","getComponent","parent","spawnHero","Number","updateLevel","pos","bullet","children","i","length","onBulletKilled","onEnemyKilled","removeHero","onHeroKilled","len","active","clickBtn","sender","str","initWave","emit","UPDATE_GAMESTATE","PAUSE","HEROSKINS","RANKED","SETTINGS","loader","loadRes","getWaveData","err","obj","waveContent","json","wave","waveCount","wavecount","waveNum","content","allRow","allCol","map","item","creep","width","addChild"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const mEmitter = require(\"./mEmitter\");\r\nconst config = require(\"config\");\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg_1: cc.Node,\r\n        bg_2: cc.Node,\r\n        title: cc.Label,\r\n\r\n\r\n        gameReadyLayer: cc.Node,\r\n        gamePlayingLayer: cc.Node,\r\n        gamePauseLayer: cc.Node,\r\n        gameOverLayer: cc.Node,\r\n        heroSkinsLayer: cc.Node,\r\n        rankedLayer: cc.Node,\r\n        settingsLayer: cc.Node,\r\n\r\n        _LayerList: {\r\n            default: [],\r\n            type: [cc.Node]\r\n        },\r\n\r\n        score: cc.Label,\r\n        scoreOver: cc.Label,\r\n\r\n        pre_hero: cc.Prefab,\r\n        _hero: cc.Node,\r\n\r\n        pre_creep: cc.Prefab,\r\n        pre_assassin: cc.Prefab,\r\n        pre_motherShip: cc.Prefab,\r\n        pre_bullet: cc.Prefab,\r\n\r\n\r\n        sound_clip: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n        _waveNum: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            notify: function(index) {\r\n                cc.log(index)\r\n            }\r\n        }\r\n\r\n\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this._LayerList = [\r\n            this.gameReadyLayer,\r\n            this.gamePlayingLayer,\r\n            this.gamePauseLayer,\r\n            this.gameOverLayer,\r\n            this.heroSkinsLayer,\r\n            this.rankedLayer,\r\n            this.settingsLayer,\r\n        ]\r\n        this.sound = cc.audioEngine.play(this.sound_clip, true, 0);\r\n        //cc.log(this._LayerList)\r\n        mEmitter.instance = new mEmitter();\r\n        //cc.log(config.event.UPDATE_SCORE)\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        //manager.enabledDebugDraw = true;\r\n        this.getData()\r\n        this.init();\r\n        this.setTouch()\r\n\r\n        mEmitter.instance.registerEvent(config.event.UPDATE_VOLUME, this.setSoundVolume.bind(this))\r\n        mEmitter.instance.registerEvent(config.event.UPDATE_SCORE, this.updateScore.bind(this))\r\n        mEmitter.instance.registerEvent(config.event.GAME_OVER, this.gameFinished.bind(this))\r\n\r\n    },\r\n\r\n    start() {},\r\n    setSoundVolume(number) {\r\n        cc.audioEngine.setVolume(this.sound, number);\r\n    },\r\n    update(dt) {\r\n        this.setBg();\r\n        if (this.gameState == config.gameState.PLAYING) {\r\n            this.bulletTime++;\r\n\r\n            if (this.bulletTime == 10) {\r\n                this.bulletTime = 0;\r\n                this.createBullet();\r\n            }\r\n            // this.spawnCreeps(dt);\r\n            // this.spawnAssassins(dt);\r\n            // this.spawnMotherShips(dt);\r\n        }\r\n    },\r\n    init() {\r\n        this.isBgMove = false;\r\n        this.bg_1.y = 0;\r\n        this.bg_2.y = this.bg_1.y + this.bg_1.height;\r\n        this.gameReadyLayer.zIndex = 1;\r\n        // this.gameOverLayer.zIndex = -1;\r\n        this.gamePauseLayer.zIndex = 2;\r\n        //this.score.zIndex = 3;\r\n        this.loadLayer(this.gameReadyLayer);\r\n        this.bulletTime = 0;\r\n        this.gameState = config.gameState.READY\r\n        this.score.string = 0;\r\n\r\n        this.spawnCreepTime = 0\r\n        this.spawnAssasinTime = 0\r\n        this.spawnMotherShipTime = 0\r\n        this.level = 1\r\n    },\r\n    setTouch() {\r\n        this.node.on(\"touchstart\", function(event) {\r\n            // this.gameState = config.gameState.PLAYING;\r\n            // this.gameReadyLayer.active = false;\r\n            // this.gamePlayingLayer.active = true;\r\n            //this.gameOverLayer.active = false;\r\n            //this.isBgMove = true;\r\n        }, this);\r\n        this.node.on(\"touchmove\", function(event) {\r\n            if (this._hero.name != \"\") {\r\n                let pos_hero = this._hero.getPosition()\r\n                let pos_mov = event.getDelta()\r\n                let x = pos_hero.x + pos_mov.x\r\n                let y = pos_hero.y + pos_mov.y\r\n                if (x < 280 && x > -280)\r\n                    if (y < 400 && y > -400)\r\n                        this._hero.setPosition(cc.v2(x, y))\r\n            }\r\n        }, this);\r\n        this.node.on(\"touchend\", function(event) {\r\n            cc.log(\"touchend\")\r\n        }, this)\r\n\r\n    },\r\n    gameFinished() {\r\n        this.gameState = config.gameState.OVER;\r\n        this.removeAllBullet()\r\n        this.removeAllEnemy()\r\n\r\n        this.loadLayer(this.gameOverLayer)\r\n        this.scoreOver.string = this.score.string;\r\n    },\r\n    spawnCreeps(dt) {\r\n        this.spawnCreepTime += dt;\r\n        if (this.spawnCreepTime >= 1 / this.level) {\r\n            this.spawnCreepTime = 0;\r\n            this.createEnemy(this.pre_creep, 1)\r\n        }\r\n    },\r\n    spawnAssassins(dt) {\r\n        this.spawnAssasinTime += dt;\r\n        if (this.spawnAssasinTime >= 2 / this.level) {\r\n            this.spawnAssasinTime = 0;\r\n            this.createEnemy(this.pre_assassin, 2)\r\n        }\r\n    },\r\n    spawnMotherShips(dt) {\r\n        this.spawnMotherShipTime += dt;\r\n        if (this.spawnMotherShipTime >= 5 / this.level) {\r\n            this.spawnMotherShipTime = 0;\r\n            this.createEnemy(this.pre_motherShip, 0.2)\r\n        }\r\n    },\r\n    createEnemy(pre_enemy, speed) {\r\n        let x = Math.floor(Math.random() * 600) + 1 - 300; // -300 300\r\n        let y = Math.floor(Math.random() * 900) + 1 + 550; // 550 1450\r\n        let enemy = cc.instantiate(pre_enemy)\r\n        let js = enemy.getComponent(\"enemy\")\r\n        js.speed = Math.floor(Math.random() * 2) + speed + this.level;\r\n        enemy.parent = this.node\r\n        enemy.setPosition(cc.v2(x, y))\r\n    },\r\n    spawnHero() {\r\n        this._hero = cc.instantiate(this.pre_hero)\r\n        this._hero.parent = this.node\r\n        this._hero.setPosition(cc.v2(0, -300))\r\n    },\r\n    updateScore(score) {\r\n        //cc.log(\"tets\")\r\n        this.score.string = Number(this.score.string) + score\r\n        this.updateLevel();\r\n    },\r\n    updateLevel() {\r\n        this.level = Math.floor(this.score.string / 50) + 1;\r\n    },\r\n    setBg() {\r\n        if (this.isBgMove) {\r\n            this.bg_2.y -= 0.5;\r\n            this.bg_1.y -= 0.5;\r\n            if (this.bg_1.y <= -this.bg_1.height)\r\n                this.bg_1.y = this.bg_2.y + this.bg_1.height;\r\n            if (this.bg_2.y <= -this.bg_2.height)\r\n                this.bg_2.y = this.bg_1.y + this.bg_2.height;\r\n        }\r\n    },\r\n    createBullet() {\r\n        if (this._hero.name != \"\") {\r\n            let pos = this._hero.getPosition()\r\n            let bullet = cc.instantiate(this.pre_bullet)\r\n            bullet.parent = this.node;\r\n            bullet.setPosition(cc.v2(pos.x, pos.y + this._hero.height / 2))\r\n        }\r\n    },\r\n\r\n    removeAllBullet() {\r\n        let children = this.node.children\r\n        for (let i = children.length - 1; i >= 0; i--) {\r\n            let bullet = children[i].getComponent(\"bullet\")\r\n            if (bullet)\r\n                bullet.onBulletKilled()\r\n        }\r\n    },\r\n    removeAllEnemy() {\r\n        let children = this.node.children\r\n        for (let i = children.length - 1; i >= 0; i--) {\r\n            let enemy = children[i].getComponent(\"enemy\")\r\n            if (enemy)\r\n                enemy.onEnemyKilled()\r\n        }\r\n    },\r\n    removeHero() {\r\n        let children = this.node.children\r\n        for (let i = children.length - 1; i >= 0; i--) {\r\n            let enemy = children[i].getComponent(\"hero\")\r\n            if (enemy) {\r\n                enemy.onHeroKilled()\r\n            }\r\n        }\r\n    },\r\n    loadLayer(node) {\r\n        let len = this._LayerList.length\r\n        for (let i = 0; i < len; i++) {\r\n            if (this._LayerList[i] === node)\r\n                this._LayerList[i].active = true;\r\n            else\r\n                this._LayerList[i].active = false;\r\n        }\r\n    },\r\n    clickBtn(sender, str) {\r\n        //cc.log(str)\r\n        switch (str) {\r\n            case \"play\":\r\n                this.spawnHero();\r\n                this.initWave(3);\r\n            case \"resume\":\r\n                this.isBgMove = true;\r\n                this.loadLayer(this.gamePlayingLayer)\r\n                this.gameState = config.gameState.PLAYING;\r\n                mEmitter.instance.emit(config.event.UPDATE_GAMESTATE, this.gameState)\r\n                break;\r\n            case \"pause\":\r\n                this.isBgMove = false;\r\n                this.loadLayer(this.gamePauseLayer)\r\n                this.gameState = config.gameState.PAUSE;\r\n                mEmitter.instance.emit(config.event.UPDATE_GAMESTATE, this.gameState)\r\n                break;\r\n            case \"restart\":\r\n                this.isBgMove = false;\r\n                this.loadLayer(this.gameReadyLayer)\r\n                this.gameState = config.gameState.READY;\r\n                this.removeAllBullet()\r\n                this.removeAllEnemy()\r\n                this.removeHero()\r\n                this.init();\r\n                break;\r\n            case \"skins\":\r\n                this.loadLayer(this.heroSkinsLayer)\r\n                this.gameState = config.gameState.HEROSKINS;\r\n                break;\r\n            case \"ranked\":\r\n                this.loadLayer(this.rankedLayer)\r\n                this.gameState = config.gameState.RANKED;\r\n                break;\r\n            case \"settings\":\r\n                this.loadLayer(this.settingsLayer)\r\n                this.gameState = config.gameState.SETTINGS;\r\n                break;\r\n            case \"back\":\r\n                this.loadLayer(this.gameReadyLayer)\r\n                this.gameState = config.gameState.READY;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n    //read json\r\n    getData() {\r\n        cc.loader.loadRes('waveconfig.json', this.getWaveData.bind(this))\r\n    },\r\n    getWaveData(err, obj) {\r\n        if (err) {\r\n            cc.log(err)\r\n            return;\r\n        }\r\n        this.waveContent = obj.json.wave\r\n        this.waveCount = obj.json.wavecount\r\n    },\r\n    initWave(waveNum) {\r\n        cc.log(this.waveContent[waveNum])\r\n        let content = this.waveContent[waveNum].content;\r\n        let allRow = this.waveContent[waveNum].allRow;\r\n        let allCol = this.waveContent[waveNum].allCol;\r\n        cc.log(content)\r\n        content.map((item, index) => {\r\n            switch (item) {\r\n                case 1:\r\n                    {\r\n                        let x = (index) % allRow\r\n                        let y = Math.floor(index / allRow);\r\n                        let creep = cc.instantiate(this.pre_creep)\r\n                        creep.x = x * 100 - (100 * allRow / 2) + 50;\r\n                        creep.y = y * 100\r\n                        cc.log(creep.width)\r\n                        this.node.addChild(creep)\r\n                        break;\r\n                    }\r\n                case 2:\r\n                    {\r\n                        let x = (index) % allRow\r\n                        let y = Math.floor(index / allRow);\r\n                        let creep = cc.instantiate(this.pre_assassin)\r\n                        creep.x = x * 100 - (100 * allRow / 2) + 50;\r\n                        creep.y = y * 100\r\n                        cc.log(creep.width)\r\n                        this.node.addChild(creep)\r\n                        break;\r\n                    }\r\n                case 3:\r\n                    {\r\n                        let x = (index) % allRow\r\n                        let y = Math.floor(index / allRow);\r\n                        let creep = cc.instantiate(this.pre_motherShip)\r\n                        creep.x = x * 100 - (100 * allRow / 2) + 50;\r\n                        creep.y = y * 100\r\n                        cc.log(creep.width)\r\n                        this.node.addChild(creep)\r\n                        break;\r\n                    }\r\n            }\r\n            if (item == 1) {\r\n\r\n            }\r\n        })\r\n    }\r\n});"]}